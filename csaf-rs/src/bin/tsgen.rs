use std::fs;
use std::path::PathBuf;

use ts_rs::TS;

use csaf_rs::csaf::validation::{ValidationError, TestResult, TestResultStatus, ValidationResult, ValidationPreset};

fn main() -> anyhow::Result<()> {
    let mut out = String::new();
    out.push_str("// This file is generated by `cargo xtask gen-ts` via csaf-rs/src/bin/tsgen.rs\n");
    out.push_str("// Do not edit by hand.\n\n");

    out.push_str(&format!("{}\n\n", <ValidationError as TS>::decl()));
    out.push_str(&format!("{}\n\n", <TestResult as TS>::decl()));
    out.push_str(&format!("{}\n\n", <TestResultStatus as TS>::decl()));
    out.push_str(&format!("{}\n\n", <ValidationResult as TS>::decl()));
    out.push_str(&format!("{}\n", <ValidationPreset as TS>::decl()));

    let manifest = PathBuf::from(env!("CARGO_MANIFEST_DIR"));
    let dest_dir = manifest.join("../csaf-validator/web-ui/src/types");
    fs::create_dir_all(&dest_dir)?;
    let dest_file = dest_dir.join("csaf_rs.d.ts");

    fs::write(&dest_file, out)?;

    println!("Wrote TypeScript definitions to {}", dest_file.display());
    Ok(())
}
